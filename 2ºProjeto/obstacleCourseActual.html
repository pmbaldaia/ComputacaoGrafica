<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>The Aviator: Part 3</title>
    <style>
        .world {
            position: absolute;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }

        body {
            margin: 0;
            color: #444;
            background: #f6f6f6;
        }
    </style>
</head>

<body>
    <!-- This DIV will hold the output -->
    <div class="world" id="world"></div>

    <script type="module">
        import * as THREE from './libs/three.module.js';
        import * as BufferGeometryUtils from './libs/BufferGeometryUtils.js';

        // THREEJS RELATED VARIABLES
        let scene, renderer, camera;

        // 3D Models
        let land, sky
        //, skater
        //, wheels
        ;

        // skater will moves according to mouse cursor position
        let mousePosX = 0;

        window.onload = function init() {
            // set up the scene, the camera and the renderer
            createScene();
            
            // add the objects
            //createPlane();
            createLand();
            createSky();

            //add the lights
            createLights();

            // listen to the mouse
            //document.addEventListener('mousemove', handleMouseMove, false);

            // set the animation function
            renderer.setAnimationLoop(render);
        }

        //INIT THREE JS, SCREEN, SCENE, CAMERA AND MOUSE EVENTS
        function createScene() {
            // create an empty scene, that will hold all our elements such as objects, cameras and lights
            scene = new THREE.Scene();

            scene.fog = new THREE.Fog(0xf7d9aa, 100);

            // create a camera, which defines where we're looking at
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
            // position the camera
            camera.position.x = 0;
            camera.position.z = 200;
            camera.position.y = 100;

            // create a render and set the size
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);

            // configure renderer clear color
            renderer.setClearColor("#e4e0ba");

            // add the output of the renderer to the DIV with id "world"
            document.getElementById('world').appendChild(renderer.domElement);

            // listen to the screen: if the user resizes it we have to update the camera and the renderer size
            window.addEventListener('resize', handleWindowResize, false);
        }

        function handleWindowResize() {
            // update height and width of the renderer and the camera
            const HEIGHT = window.innerHeight;
            const WIDTH = window.innerWidth;
            renderer.setSize(WIDTH, HEIGHT);
            camera.aspect = WIDTH / HEIGHT;
            camera.updateProjectionMatrix();
        }

        function createSkater() {
            skater = new THREE.Group();
        }

        function createLand() {
            // create the geometry (shape) of the cylinder: 
            // parameters are: radius top, radius bottom, height, number of segments on the radius, number of segments vertically
            let geometry = new THREE.CylinderGeometry(600, 600, 800, 40, 10);
            // rotate the geometry on the x axis (local transformation)
            //geometry.rotateX(-Math.PI / 2);

            // create the material
            let material = new THREE.MeshBasicMaterial({
                color: 0x68c3c0,
                transparent: true,
                opacity: .6
            });

            // create the mesh: geometry + material
            land = new THREE.Mesh(geometry, material);

            // push it a little bit at the bottom of the scene
            sea.position.y = -600;

            console.log("Sea created")
            scene.add(sea);
        }

        function createSky() {
            // create an empty container
            sky = new THREE.Object3D();
            // push its center a bit towards the bottom of the screen (like the sea)
            sky.position.y = -600;

            console.log("Sky created")
            scene.add(sky);
        }

        function createLights() {
            let light = new THREE.AmbientLight(0xffffff, 0.5);
            sceneVertical.add(light);

            let light2 = new THREE.PointLight(0xffffff, 1);
            light2.position.set(8, 4, 0);
            sceneVertical.add(light2);
        }

        function render() {

            // update plane position - light will follow the plane
            updatePlane();

            // render
            renderer.render(scene, camera);
        }

        // HANDLE MOUSE EVENTS
        function handleMouseMove(event) {
            let tx = -1 + (event.clientX / window.innerWidth) * 2;
            mousePosX = tx
        }

        function updatePlane() {
            let targetX = mousePosX * 100;

            // update the airplane's position
            skater.position.x = targetX;
        }
    
    </script>
</body>

</html>